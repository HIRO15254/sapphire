{
  "id": "snapshot_1769586437015_39qqxvlxn",
  "approvalId": "approval_1769586436962_2ga8ch441",
  "approvalTitle": "Tech Document - Sapphire Technology Stack",
  "version": 1,
  "timestamp": "2026-01-28T07:47:17.014Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Technology Stack\n\n## Project Type\n\nProgressive Web Application (PWA) - ライブポーカーセッション追跡のためのフルスタックWebアプリケーション。モバイルとデスクトップの両方に対応し、ネイティブアプリに近い体験を提供。\n\n## Core Technologies\n\n### Primary Language(s)\n- **Language**: TypeScript 5.8.2\n- **Runtime**: Node.js (サーバーサイド)、ブラウザ (クライアントサイド)\n- **Package Manager**: Bun\n\n### Key Dependencies/Libraries\n\n**フロントエンド:**\n- **Next.js 15.2.3**: React 19ベースのフルスタックフレームワーク（App Router使用）\n- **Mantine v8.3.10**: UIコンポーネントライブラリ（Charts, Form, Dates, Notifications含む）\n- **TipTap v3.13.0**: リッチテキストエディタ\n- **dnd-kit v6.3.1**: ドラッグ&ドロップ機能\n- **Recharts 2**: データ可視化・チャート\n- **Tabler Icons React v3.36.0**: アイコンライブラリ\n\n**バックエンド:**\n- **tRPC 11.0.0**: 型安全なAPIレイヤー\n- **Drizzle ORM v0.41.0**: TypeScriptファーストのORM\n- **NextAuth 5.0.0-beta.25**: 認証（Google, Discord OAuth + Email/Password）\n- **Zod v3.24.2**: スキーマバリデーション\n- **SuperJSON v2.2.1**: データシリアライゼーション\n\n**状態管理:**\n- **React Query (TanStack) v5.69.0**: サーバー状態管理とキャッシング\n\n### Application Architecture\n\n**フルスタックモノリス with App Router:**\n- Next.js App Routerによるファイルベースルーティング\n- Server Components (RSC) とClient Componentsのハイブリッド\n- tRPCによる型安全なクライアント-サーバー通信\n- React Queryによるデータフェッチングと状態同期\n\n**レイヤー構造:**\n```\nsrc/\n├── app/           # ルーティング・ページ（Next.js App Router）\n├── components/    # UIコンポーネント\n├── server/        # サーバーサイドロジック\n│   ├── api/       # tRPCルーター・スキーマ\n│   ├── db/        # データベーススキーマ・マイグレーション\n│   └── auth/      # 認証設定\n├── trpc/          # tRPCクライアント設定\n├── contexts/      # Reactコンテキスト\n└── lib/           # ユーティリティ\n```\n\n### Data Storage\n- **Primary storage**: PostgreSQL（postgres driver v3.4.4経由）\n- **ORM**: Drizzle ORM（マイグレーション、スキーマ定義）\n- **Data formats**: JSON（API通信）、SuperJSON（複雑な型のシリアライゼーション）\n\n### External Integrations\n- **APIs**: Google Maps API（店舗位置情報）\n- **Authentication**: OAuth 2.0（Google, Discord）、bcryptによるパスワードハッシュ\n- **Protocols**: HTTP/REST（Next.js API Routes）、tRPC over HTTP\n\n### Monitoring & Dashboard Technologies\n- **Dashboard Framework**: React 19 + Mantine\n- **Real-time Communication**: React Queryによるポーリング・リフェッチ\n- **Visualization Libraries**: Recharts、Mantine Charts\n- **State Management**: React Query（サーバー状態）、React Context（UI状態）\n\n## Development Environment\n\n### Build & Development Tools\n- **Build System**: Next.js（Turbopack対応）、tsx（スクリプト実行）\n- **Package Management**: Bun\n- **Development workflow**: `bun run dev`でホットリロード、Turbopackによる高速ビルド\n\n### Code Quality Tools\n- **Static Analysis**: Biome v2.2.5（リンティング）\n- **Formatting**: Biome v2.2.5（フォーマッティング）\n- **Testing Framework**:\n  - Unit/Integration: Vitest v4.0.15\n  - E2E: Playwright v1.57.0\n  - Component Preview: React Cosmos v7.1.0\n  - Coverage: v8（80%閾値）\n- **Type Checking**: TypeScript strict mode\n\n### Version Control & Collaboration\n- **VCS**: Git\n- **Branching Strategy**: Feature branches + main\n- **Code Review Process**: GitHub Pull Request\n\n### Dashboard Development\n- **Live Reload**: Next.js Fast Refresh / Turbopack HMR\n- **Port Management**: 設定可能（デフォルト3000）\n\n## Deployment & Distribution\n- **Target Platform(s)**: Webブラウザ（モバイル・デスクトップ）\n- **Distribution Method**: Webホスティング（PWAとしてインストール可能）\n- **Installation Requirements**: モダンブラウザ、PostgreSQLデータベース\n- **Update Mechanism**: Service Workerによる自動更新通知、version.json監視\n\n## Technical Requirements & Constraints\n\n### Performance Requirements\n- セッション記録時の即座なUI反応\n- React Queryによる効率的なキャッシングとバックグラウンド更新\n- httpBatchStreamLinkによるAPI呼び出しのバッチ処理\n\n### Compatibility Requirements\n- **Platform Support**: モダンブラウザ（Chrome, Firefox, Safari, Edge）\n- **Dependency Versions**: Node.js 18+, PostgreSQL 14+\n- **Standards Compliance**: PWA仕様、OAuth 2.0\n\n### Security & Compliance\n- **Security Requirements**:\n  - NextAuth middlewareによるルート保護\n  - bcryptによるパスワードハッシュ化\n  - JWTベースのセッション管理\n- **Data Isolation**: マルチテナント設計（全クエリにuserIdフィルタ）\n- **Threat Model**: ユーザーデータの分離、認証必須\n\n### Scalability & Reliability\n- **Expected Load**: 個人利用〜中規模ユーザーベース\n- **Availability Requirements**: PWAによるオンライン依存（オフライン機能は将来検討）\n- **Growth Projections**: ユーザー数増加に応じたDBスケーリング\n\n## Technical Decisions & Rationale\n\n### Decision Log\n1. **Next.js App Router**: Server Componentsによるパフォーマンス最適化、React 19の最新機能活用\n2. **tRPC**: フロントエンド-バックエンド間の完全な型安全性、コード生成不要\n3. **Drizzle ORM**: TypeScriptネイティブ、軽量、マイグレーション機能充実\n4. **Mantine**: 豊富なコンポーネント、日本語対応、アクセシビリティ\n5. **Biome**: ESLint + Prettierの代替として高速な単一ツール\n6. **Bun**: npm/yarnより高速なパッケージ管理とスクリプト実行\n\n## Known Limitations\n\n- **オフライン機能なし**: 現時点ではオンライン接続必須\n- **リアルタイム同期**: WebSocket未実装（React Queryポーリングで対応）\n- **NextAuth Beta**: 5.0.0-beta版使用による潜在的な破壊的変更リスク\n- **日付メモ機能**: 現在保留中\n",
  "fileStats": {
    "size": 6524,
    "lines": 145,
    "lastModified": "2026-01-28T07:47:09.740Z"
  },
  "comments": []
}