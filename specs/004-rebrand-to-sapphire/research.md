# Research: Sapphireプロジェクト リブランディング

**Feature**: 004-rebrand-to-sapphire
**Date**: 2025-10-31
**Spec**: [spec.md](./spec.md) | **Plan**: [plan.md](./plan.md)

## 概要

このドキュメントは、Mantine Vibe TemplateからSapphire（ポーカーセッショントラッカー）へのリブランディングに関する調査結果とベストプラクティスをまとめたものである。主な調査領域は以下の通り：

1. プロジェクトリブランディングのベストプラクティス
2. PWAアイコンとマニフェスト更新の標準手法
3. メタデータとドキュメントの一貫性確保
4. Git履歴と歴史的参照の保持方法

## 調査項目

### R-001: プロジェクトリブランディングのベストプラクティス

**Decision**: メタデータとドキュメントを優先度順（P1:アイデンティティ確立 → P2:ドキュメント刷新 → P3:メタデータ統一）に更新し、一貫性を確保する。

**Rationale**:
- **第一印象が最重要**: ユーザーが最初に目にするブラウザタブ、アイコン、README.mdを優先的に更新することで、即座にSapphireプロジェクトとして認識される
- **段階的な更新**: 優先度順に更新することで、途中でレビューを挟みやすく、問題の早期発見が可能
- **一貫性の確保**: すべてのメタデータファイルで同じプロジェクト名、説明、著作権情報を使用することで、ブランドの統一感を実現

**Alternatives Considered**:
1. **一括更新**: すべてのファイルを一度に更新する
   - **却下理由**: レビューが困難になり、ミスの発見が遅れる可能性が高い
2. **ランダム順**: 気づいたファイルから順次更新
   - **却下理由**: 重要なファイル（ブラウザタブタイトルなど）の更新が後回しになる可能性があり、ユーザー体験に悪影響

**Implementation Notes**:
- P1タスクを完了後、ブラウザで確認してから次のフェーズに進む
- 各フェーズでコミットを作成し、レビューを受ける

---

### R-002: PWAアイコンとマニフェスト更新の標準手法

**Decision**: PWA manifest（manifest.ts）を更新し、すべてのアイコンファイル（6個）をユーザー提供のSapphireブランドアイコンに置き換える。アイコンサイズとpurpose属性は現在の仕様を維持。

**Rationale**:
- **PWA標準準拠**: 現在のmanifest.tsは既にPWA標準（Web App Manifest仕様）に準拠しているため、構造は変更せず、メタデータ（name、short_name、description）のみ更新
- **アイコンサイズ**: 192x192と512x512は PWA標準で推奨されるサイズであり、変更不要
- **maskable アイコン**: Android Adaptive Iconsに対応するため、maskable版も必須
- **ブラウザキャッシュ対策**: マニフェストのバージョンや更新は、Next.jsのビルドハッシュによって自動的に処理されるため、手動でのキャッシュバスティングは不要

**Alternatives Considered**:
1. **新しいアイコンサイズを追加**: 144x144、384x384などの中間サイズを追加
   - **却下理由**: 192x192と512x512で十分であり、追加サイズはファイルサイズを増やすだけでメリットが少ない
2. **SVGアイコンを使用**: ベクター形式で全サイズをカバー
   - **却下理由**: ブラウザのSVGアイコンサポートがまだ不完全で、PNG/ICO形式が最も互換性が高い

**Implementation Notes**:
- アイコンファイルは`public/`ディレクトリに配置（Next.js静的ファイル配信）
- `favicon.ico`はブラウザタブ、`apple-touch-icon.png`はiOSホーム画面用
- アイコン更新後、PWAとしてインストールして表示を確認する

**Required Icon Files**:
```
public/
├── favicon.ico (16x16, 32x32, 48x48マルチサイズ)
├── apple-touch-icon.png (180x180)
├── icon-192x192.png
├── icon-512x512.png
├── icon-192x192-maskable.png
└── icon-512x512-maskable.png
```

---

### R-003: README.md刷新の構成とコンテンツ戦略

**Decision**: README.mdを以下の構成で刷新する：
1. プロジェクト概要（Sapphire - ポーカーセッショントラッカー）
2. 技術スタック（Next.js 15、tRPC、Drizzle ORM、Mantine v8、PostgreSQL）
3. 主な機能（実装状況）
4. クイックスタート（セットアップ手順）
5. 開発コマンド
6. プロジェクト構造
7. ライセンスと貢献

**Rationale**:
- **ユーザーファースト**: 最初にプロジェクトの目的を明確にすることで、5秒以内に理解可能（SC-001）
- **開発者フレンドリー**: 技術スタックとセットアップ手順を早い段階で示すことで、新規開発者のオンボーディングを促進（SC-002：10分以内に理解）
- **実装状況の透明性**: ポーカーセッショントラッカーの計画/実装中機能を明示することで、プロジェクトの現在地を共有
- **憲法原則 III準拠**: すべて日本語で記述（ユーザーと開発者が日本語話者のため）

**Alternatives Considered**:
1. **英語で記述**: 国際的な開発者向けに英語で記述
   - **却下理由**: 憲法原則 III「日本語ファースト」に違反。主要ステークホルダーとユーザーが日本語話者
2. **テンプレート説明を残す**: "Mantine Vibe Templateから派生"といった説明を含める
   - **却下理由**: テンプレートの痕跡を残すことは、リブランディングの目的（SC-003：参照0件）に反する

**Implementation Notes**:
- 既存のREADME.mdから、有効なセットアップ手順（Docker Compose、データベース初期化）は保持
- バッジ（CI、License、TypeScript等）は必要に応じて更新
- 実装済み機能セクションには「ポーカーセッショントラッカー（実装中）」を記載

---

### R-004: package.json メタデータ更新の標準フィールド

**Decision**: package.jsonの以下のフィールドを更新する：
- `name`: "sapphire"
- `description`: "Sapphire - ポーカーセッションを記録・分析するアプリケーション"
- `keywords`: `["poker", "session-tracker", "sapphire", "nextjs", "trpc", "drizzle-orm"]`
- `author`: "Sapphire Contributors"
- `repository.url`: 実際のGitHubリポジトリURL（確定後）
- `bugs.url`: 実際のGitHub Issues URL（確定後）
- `homepage`: 実際のGitHubリポジトリURL（確定後）

**Rationale**:
- **npm標準準拠**: package.jsonの標準フィールドを使用することで、npmパッケージとしての互換性を保つ（将来的な公開に備える）
- **SEO と発見性**: keywordsフィールドに適切なキーワードを設定することで、npm検索やGitHub検索での発見性を向上
- **法的明確性**: authorフィールドを"Sapphire Contributors"に統一することで、LICENSEファイルと一貫性を保つ

**Alternatives Considered**:
1. **個人名を著者に設定**: 特定の個人を著者として記載
   - **却下理由**: コミュニティプロジェクトとして"Contributors"形式の方が適切
2. **repository URLをplaceholderに**: "https://github.com/your-username/sapphire"のようにplaceholderを残す
   - **却下理由**: 実際のURLが確定次第、正確なURLを設定すべき（placeholderは混乱を招く）

**Implementation Notes**:
- `private: false`を維持（将来的なnpm公開を想定）
- `version`は変更しない（リブランディングはバージョン変更には該当しない）
- dependenciesとdevDependenciesは変更しない（技術スタックは同じ）

---

### R-005: Git履歴と歴史的参照の保持戦略

**Decision**: Git履歴は一切変更せず、`specs/001-todo-app/`フォルダも歴史的参照として保持する。リブランディングは新しいコミットとして記録する。

**Rationale**:
- **Git履歴の不変性**: Git履歴の書き換え（rebase、filter-branch等）は、共同作業において混乱を招き、既存のクローンとの互換性を破壊する
- **開発の透明性**: プロジェクトがテンプレートから出発し、Todoアプリを経て、ポーカートラッカーに進化した過程を記録として残すことは、開発の透明性と学習の観点から価値がある
- **仕様ドキュメントの価値**: `specs/001-todo-app/`は、削除済み機能の仕様書として、将来的に類似機能を実装する際の参考資料になる

**Alternatives Considered**:
1. **Git履歴を書き換え**: rebaseやfilter-branchで"todo"や"template"を含むコミットを削除
   - **却下理由**: 既存のクローンとの互換性が失われ、共同作業が困難になる。また、開発の歴史が失われる
2. **specs/001-todo-app/を削除**: 削除済み機能の仕様書も削除
   - **却下理由**: 歴史的参照として保持することで、プロジェクトの進化を記録できる。また、spec.mdのOut of Scopeで明示的に保持することを宣言済み

**Implementation Notes**:
- リブランディングコミットのメッセージは明確に（例: "feat: Sapphireプロジェクトにリブランディング"）
- コミットメッセージは日本語で記述（憲法原則 III）
- `specs/001-todo-app/`にREADME.mdを追加して、「この機能は削除済みで、歴史的参照として保持されている」旨を明記することも検討

---

### R-006: constitution.md 更新の影響範囲

**Decision**: constitution.mdのタイトル部分のみを「Sapphireプロジェクト憲法」に更新し、原則の内容は変更しない。

**Rationale**:
- **憲法の安定性**: 憲法の原則（TDD、仕様明確化、日本語ファースト等）はプロジェクト名に依存しないため、タイトル以外の変更は不要
- **最小限の変更**: リブランディングの範囲を明確にするため、必要最小限の変更に留める
- **憲法バージョン**: タイトル変更はPATCHレベルの変更（非意味的な改善）であり、バージョンアップは不要

**Alternatives Considered**:
1. **憲法全体を見直し**: 原則の内容もSapphire/ポーカートラッカーに合わせて調整
   - **却下理由**: 原則はプロジェクト名に依存せず、普遍的な開発原則であるため、変更不要
2. **constitution.mdを削除**: 憲法ファイル自体を削除して、新しいプロジェクト憲法を作成
   - **却下理由**: 既存の憲法は引き続き有効であり、削除する理由がない

**Implementation Notes**:
- Line 17のタイトル行のみ更新: `# Mantine Vibe Template プロジェクト憲法` → `# Sapphireプロジェクト憲法`
- 憲法のバージョン番号は変更しない（タイトル変更は意味的な変更ではないため）

---

## 技術的な判断のまとめ

### リブランディング実装戦略

1. **優先度順の実装**:
   - P1: ブラウザタブ、アイコン、マニフェスト（ユーザーの第一印象）
   - P2: README.md（開発者のオンボーディング）
   - P3: package.json、LICENSE、constitution.md（メタデータの一貫性）

2. **検証手法**:
   - 各フェーズ完了後、ブラウザで表示確認
   - PWAとしてインストールしてアイコン確認
   - package.jsonの内容を手動でレビュー
   - README.mdを読んで、10分以内に理解可能か確認

3. **Git戦略**:
   - フェーズごとにコミット作成
   - コミットメッセージは日本語で明確に
   - Git履歴は一切書き換えない

4. **ドキュメント戦略**:
   - すべて日本語で記述（憲法原則 III）
   - 技術スタックとセットアップ手順を明確に
   - 実装状況を透明に共有

### リスクと対策

| リスク | 影響 | 対策 |
|--------|------|------|
| PWAアイコンのキャッシュ | ユーザーがインストール済みの場合、新アイコンが反映されない | マニフェストの更新と再インストールを促すドキュメントを用意 |
| 古いデータベース名が残る環境 | ローカル環境で`todoapp`データベースが残る | quickstart.mdに移行手順を記載（既に`sapphire`に変更済みを明記） |
| リポジトリURLが未確定 | package.jsonにplaceholderが残る | 確定次第、別コミットで更新する旨をtasks.mdに記載 |
| メタデータの不一致 | 一部のファイルでテンプレート参照が残る | 実装前にGrep検索で"Mantine Vibe"、"Todo"を全検索し、更新対象を確認 |

### 成功基準の達成方法

- **SC-001**: P1フェーズでブラウザタブ、アイコン、README先頭を更新 → 5秒以内の認識を実現
- **SC-002**: P2フェーズでREADME.mdを構造化 → 10分以内の理解を実現
- **SC-003**: 実装前にGrep検索 → 参照0件を達成
- **SC-004**: P1フェーズで全アイコン更新 → 統一されたアイコン表示を実現
- **SC-005**: 既存のセットアップ手順を保持・改善 → 30分以内の環境構築を維持
- **SC-006**: P3フェーズで全メタデータファイルを更新 → 統一されたメタデータを実現

---

## 次のステップ

この調査結果を基に、Phase 1でquickstart.mdを作成する。quickstart.mdには以下を含める：

1. リブランディング後のプロジェクトのセットアップ手順
2. Sapphireとしての開発開始方法
3. ポーカーセッショントラッカーの実装状況
4. よくある質問（FAQ）：データベース名の変更、古いアイコンのキャッシュ等

**Phase 0完了**: すべての技術的判断が明確化され、実装に必要な情報が揃った。
